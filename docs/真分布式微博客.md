# 可互通消息的分布式微博客

## 背景

- 从几年前开始，我就经常思考如何实现一个真分布式 (不是多中心，而是真正的零中心) 的陌生人社交网络。Mastodon (长毛象) 的出现让我看到希望，但长毛象的缺点也明显 (多中心，不是彻底的分布式).
- 最近我终于想到了一个办法，可以做到真的零中心，非常开放。普通社区、论坛、长毛象都有站长或管理员，总有人有特权。但在我新构思的这个分布式网络里，没有管理员，没有人拥有特权，每个参与者都是平等的。

## 四大重点：

1. 真分布式, 每个用户都是完全独立的, 拥有绝对的自主权
2. 可互相关注, 可以互相@
3. 静态网站也可参与 (没有网站也可以使用 "只读模式")
4. 从根源上防广告、防灌水，零成本防敏感词攻击

## 什么是 "分布式微博客"？

请允许我稍稍啰嗦一点，一步一步说明这个概念。

- **微博客**是指像 twitter、饭否、新浪微博那样，有一个集中的平台，用户必须去平台注册一个账号，并且平台有删除用户发表的内容、删除用户账号的权力。
- **联邦式微博客**是指像 Mastodon (长毛象) 那样, 没有一个集中的平台, 但有多个 "实例", 普通用户仍需要去 "实例" 注册账号, 实例也有权删除用户的信息. (用户可跨实例互通消息)
- **Mastodon的缺点**
  1. 用户仍然受到 "实例" 的管理, 需要遵守实例的规定.
  2. 如果自建实例, 需要一定的技术能力和成本, 并且也要花时间精力去管理用户的发言.
- **分布式微博客**比联邦式更分散, 没有平台没有实例, 每个用户都拥有绝对的自主权, 不需要遵守别人的规定, 想说什么就说什么, 也不需要担心别人说错话牵连到自己身上, 因为别人与自己根本就不在同一平台或同一实例之中, 本质上互相独立.
- 分布式微博客的**缺点也显然易见**: 像个孤岛, 荒无人烟, 无法关注别人, 无法互通消息 (互相@).

希望大家能一起来建立一个**可互通消息的分布式微博客群岛**, 其中每个小岛既拥有独立自主性, 也不再是孤岛. 取名 **iPelago**, 源于群岛的英文 archipelago, 中文名 "群岛".

## 非常容易参与

- iPelago 群岛的第一大特点就是非常容易参与, 只要拥有静态网页就可以当岛主 (详见后文 "如何建岛"). 而拥有静态网页也非常容易, 免费的方案有 GitHub, Bitbucket, Gitee, Coding, GitLab... 等等, 收费(低价格) 的方案就更多了.
- 另外, 如果不想当岛主, 不想建岛, 也可以当 "**漂流族**", 以只读模式浏览各岛的消息, 不需要注册账号.

## iPelago 群岛不是法外之地

- 不管静态网页还是独立网站, 背后都有服务商, 服务商有实体有国籍, 因此 iPelago 群岛中的**每一个小岛, 都需要遵守服务商所在地的法律**.
- 但由于每个小岛本质上是独立的, 不会被平台过分严格的管理所误伤, 可以自己把握发言分寸. 并且不用担心别人的发言会牵连自己.

## 如何建岛?

1. 假设你已经拥有一个独立网站 (静态网页也可), 并且知道怎样发布静态文件. (如果不懂，我另外再写教程，不难，免费，网上已有很多这方面的教程。)
2. 提供一个网址 (例如 https://example.com/ipelago.json ) 作为这个**小岛的地址**, 任何人访问该地址应可获得一个 json 文件, 其内容见后文。

OK, 一个岛就这样建好了，别人可以通过**小岛地址**来关注这个岛、接收这岛发出的消息、向这个岛发送消息。

## 关于岛的地址与 JSON

- 岛的地址可以是一个静态文件，也可以是一个 api 接口，只要能返回一个 json 文件即可。
- 该 json 文件的字符编码规定为 UTF-8
- 该 json 文件的体积上限为 1KB (我希望尽可能节约公共资源)

该 json 文件应包含以下内容 (我会提供工具方便生成这种 json 文件)：

```
{
  name: "某某的小岛",
  avatar: "https://example.com/avatar.jpg",
  email: "someone@example.com",
  link: "https://example.com/ipelago.html",
  address: "https://example.com/ipelago.json",
  messages: [
    {
      ctime: 1623209466,
      at: "someone@example.com",
      body: "今天天气很好",
      md: false
    },
    {
      ctime: 1623209000,
      at: "another@example.com",
      body: "我发现有个游戏很好玩",
      md: false
    }
  ]
}
```

- **name**: 岛名，相当于用户名或昵称（必填）
- **avatar**: 头像图片的网址，头像图片应为正方形，建议头像体积控制在 50KB 以下。（可留空）
- **email**: 岛主的真实电子邮件，需要确保每个小岛的 email 不相同，同时可作为后备联系方式。(必填)
- **link**: 一个网址，可以是岛主的博客，也可以是**小岛的网页版**，也可以是岛主的其他社交帐号地址。（可留空）
- **address**: 小岛地址，即该 json 文件本身的地址。（可留空）
- **messages**: 多条消息，按发布日期倒序排列（最新的排在最前）。至少包含一条信息。
  - **ctime**: (必填)发布时间，一个普通的时间戳, 精确到秒 (不包括毫秒), 不需要管时区问题。
  - **at**: (可留空)另一个岛的 email, 用来实现 @ 别人的效果。
  - **body**: (必填)消息的正文，建议尽量简短，如果需要表达的内容较多，可添加链接，引导读者去网站看全文。
  - **md**: (可留空)默认为 false, 表示消息正文 (text) 的格式是纯文本。如果改为 true 则表示消息正文的格式是 markdown.

### JSON 文件体积限制

- 由于上述 JSON 文件是有体积限制的，不可能包含无限多的消息，因此在 messages 里只包含最新的消息，不包含旧消息。
- 旧消息可以由读者保存在**客户端**中（我会提供一个客户端），也可以由岛主保存在**小岛的网页版**中。
- 小岛的网页版其实就是一个普通的网页，其内容与上述 JSON 的内容差不多，但可以用来保存历史消息，因此强烈建议做一个网页版（我会做一个示例，让大家可以直观地了解大概是个什么样的网页）。

